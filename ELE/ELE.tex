\chapter{Électronique des Resistive Plate Chamber}
\renewcommand\chapterillustration{ELE/ele}
\ThisULCornerWallPaper{1}{\chapterillustration}
\minitoc

\lettrine[lines=4, slope=-0.5em]{C}{e} chapitre présente le développement d'un nouveau type de PCB avec lecture des deux côté des strips. Cette configuration permet, grâce au temps de propagation du signal de connaitre la position du hit le long du strip touché. Ce chapitre présente également les premiers résultats obtenus lors de tests en faisceaux au SPS en mai 2017.

\section{Principe de fonctionnement}

Chaque chambres actuels de CMS ont un PCB segmentés en trois zones selon $\eta$ appelées "$\eta$ segments", chaque $\eta$ segments contenant \num{32} strips. Lors du passage d'un muon, la position de celui-ci selon $\eta$ n'est connu qu'avec une résolution correspondant à la longueur du strip touché.

Afin de résoudre ce problème et d'éviter la segmentation en $\eta$ du PCB, un type de PCB permettant la lecture des deux côté des strip a été proposé (cf.fig~\ref{PCB1}).
\vspace*{0.5cm}
\begin{figure}[ht!]
	\centering
	\includegraphics[width=1\textwidth]{ELE/PCB1.png}
	\captionof{figure}{Schèma du PCB permettant la lecture des deux côté des strips.}
	\label{PCB1}
\end{figure}

Les strips font toute la longeur de la chambre, chaque bouts du strips est relié à une voie d'électronique. Le retour du strips est effectué sur les côté du PCB, dans une zone protéger par un blindage relié à la masse afin qu'il ne soit pas affecter par le passage des particules.
\newpage
Ce type de configuration permet de connaitre la position du hits le long du strips. En effet en posant $L$ la longueur de la ligne (strip et retour), $Y$ la position du hits le long du strips, $t_1$ et $t_2$ le temps de propagation du signal pour rejoindre l'un et l'autre côté de la ligne, $t$ le temps de déclenchement et $v$ la vitesse de propagation du signal :
\begin{equation}
Y=\frac{L}{2}-\frac{v(t_2-t_1)}{2}
\end{equation} 

La résolution temporelle du signal peut également être calculé :
\begin{equation}
\label{myformule}
t=-\frac{(t_1+t_2)}{2}+\frac{L}{2v}
\end{equation}

\section{Le Prototype}
Afin d'étudier la faisabilité, un PCB de \SI{50}{\centi\meter} de long a été créé (cf.fig~\ref{PCB2}). Il est composé de \num{32} strips espacé de \SI{4}{\milli\meter}. Ces strips sont lus de chaque côté grâce à \num{2} ASIC appelé PETIROC2 \cite{Monzo:2017quz} de \num{32} entrées, développé par le groupe OMEGA. Ces ASIC sont utilisés pour mettre en forme les signaux. Deux TDC (appelés Mézzanines) de \num{24} voies chacun et de résolution temporelle \SI{25}{\pico\second}, développés par nos collègue de Tsinghua sont utilisé afin de mesurer le temps d'arrivé des signaux envoyé par les PETIROC2.

\begin{figure}[ht!]
	\centering
	\includegraphics[width=0.77\textwidth]{ELE/PCB2.png}
	\captionof{figure}{Le PCB avec lecture des strips des deux côtés.}
	\label{PCB2}
\end{figure}

\subsection{Le TDC}
\begin{wrapfigure}[7]{R}{0.40\textwidth}
	\vspace*{-1cm}
	\centering
	\includegraphics[width=0.30\textwidth]{ELE/TDC.png}
	\caption{Un TDC fournit par nos collègues de Tsinghua.}
	\label{tdc}
\end{wrapfigure}
Le TDC fournit par nos collègues chinois possède \num{24} voies et une résolution temporelle de \SI{25}{\pico\second}. Il est basé sur un FPGA de type Cyclone-II. Cette carte reçoit les données des PETIROC2 grâce à des connecteur à entrées différentielles. Les données sont envoyées grâce à un port Éthernet utilisant les protocoles TCP\footnote{Transmission Control Protocol.}/IP\footnote{Internet Protocol.}.

\subsection{L'ASIC PETIROC2}

\begin{wrapfigure}[10]{R}{0.40\textwidth}
	\centering
	\vspace*{-1cm}
	\includegraphics[width=0.25\textwidth]{ELE/PETIROC.png}
	\caption{Schéma électronique du PETIROC2.}
	\label{PETIROC2}
\end{wrapfigure}

Le PETIROC2 (cf.fig~\ref{PETIROC2}) repose sur une technologie de fonderie AMS SiGe \SI{0.35}{\micro\meter}. La puce est insérée dans un boitier de taille \num{4.6}$\times$\SI{42}{\square\milli\meter}, d'épaisseur \SI{1.6}{\milli\meter} et comporte \num{208} pattes dont \num{32} voies d'entrée. Le schéma simplifié du PETIROC2 est donné figure \ref{SchemePETIROC}. Chaque voie permet de mesurer le temps de vol grâce à un TDC intégré et un ADC de \num{10}bits ainsi que la charge sur \num{10}bits. La gamme de réglage du seuil est compris entre \SI{160}{\femto\coulomb} et \SI{400}{\pico\coulomb} global aux \num{32} voies. Un ajustement voie par voie est possible grâce à un DAC de \num{6}bits. 

\begin{figure}[ht!]
	\centering
	\includegraphics[width=0.65\textwidth]{ELE/Scheme.png}
	\captionof{figure}{schéma simplifié du PETIROC2.}
	\label{SchemePETIROC}
\end{figure}

Le PETIROC2 possède une gigue\footnote{La gigue ou \textit{jitter} en anglais, provient des fluctuations statistiques et du bruit de l'électronique. À cause de ces fluctuations, deux signaux identiques ne vont pas passer le seuil de déclenchement au même point, donnant ainsi une variation temporelle du point de déclenchement qui dépend de l'amplitude des fluctuations.} faible ($<\SI{20}{\pico\second}$ pour une charge supérieur à \SI{1.5}{\milli\volt}) (cf.fig\ref{jitter}).

\begin{figure}[ht!]
	\centering
	\includegraphics[width=0.65\textwidth]{ELE/Jitter.png}
	\captionof{figure}{Gigue en fonction dela tension injectée. Le seuil est fixé à \SI{0.5}{\milli\volt}.}
	\label{jitter}
\end{figure}



\vspace{0.4cm}
\section{Résolution temporelle du PCB}
La résolution temporelle du PCB a été testé en injectant un signal carré de \SI{10}{\volt} d'amplitude et de durée \SI{10}{\nano\second} à travers un condensateur de \SI{1}{\pico\farad} sur des points de test (en bleu sur la figure \ref{PCB2}). Un exemple de la distribution temporelle de $t_{1}-t_{2}$ pour un strip est donné figure\ref{RESOLUTION}

\begin{figure}[!ht]
	\centering
	\scalebox{1.5}{\includetex{ELE/TDCTimeResolution}}
	\caption{Résolution temporelle d'un strips du PCB. Le signal est est carré d'amplitude \SI{10}{\volt} et de durée \SI{10}{\nano\second}. Le signal traverse un condensateur de \SI{1}{\pico\farad}.}
	\label{RESOLUTION}
\end{figure}

Un ajustement de la distribution temporelle de $T_{1}-T_{2}$ par une Gaussienne est effectué. La valeur moyen de la Gaussienne n'est pas pertinentes car les TDC n'ont pas été calibrés. Cependant, l'écart type de la Gaussienne $\sigma$ permet de déduire la résolution temporelle du PCB. En effet, en supposant les variables $t_1$ et $t_2$ décorrélées on a
\begin{equation}
\sigma_{t_1+t_2}=\sqrt{\sigma_{t_1}^2+\sigma_{t_2}^2}
\end{equation}
En supposant de plus que $\sigma_{t_1}^2=\sigma_{t_2}^2=\sigma_{elec}^2$
\begin{equation}
\frac{\sigma_{t_1+t_2}}{\sqrt{2}}=\sigma_{elec}
\end{equation}
La résolution temporelle du PCB est estimé à \SIrange{20}{30}{\pico\second}

\section{Test en faisceau au SPS (Mai 2017)}
\vspace*{-0.4cm}
Deux chambres double gaps en Bakélite de gap \SI{1.4}{\milli\meter} (\SI{1.6}{\milli\meter}) et épaisseur d'électrodes \SI{1.4}{\milli\meter} (\SI{1.6}{\milli\meter}) ont été instrumenté avec le PCB à strips et testées sur la ligne H4 du SPS dans la \textit{North Area} (cf.fig~\ref{complexe}). Les chambres ont été posées sur une table de positionnement réglable verticalement et horizontalement (cf.fig\ref{setup2017}).
\begin{figure}[ht!]
	\centering
	\includegraphics[width=0.65\textwidth]{ELE/setup2017.jpg}
	\captionof{figure}{Les deux chambres en Bakélite posées sur la table de positionnement.}
	\label{setup2017}
\end{figure}

Deux groupes de deux PM de \SI{5}{\centi\meter} de largeur sont placé de part et d'autre des chambres. Les PM d'un même groupe sont placé perpendiculairement l'un par rapport à l'autre (cf.fig~\ref{setup2017}). Deux autres PM de plus petites dimensions (\SI{1.2}{\centi\meter}) sont placés d'un côté des chambres afin de réduire la zone de déclenchement (cf.fig~\ref{smallPM}).  

\marginpar
{
	\centering
	\includegraphics[width=\marginparwidth]{ELE/BigSmallScintillators.jpg}
	\captionof{figure}{Les différents PM placé d'un côté des chambres.}
	\label{smallPM}
}

La coïncidence des scintillateurs est envoyé dans les données comme s'il s'agissait d'un signal d'un strips. Chaque Mezzanine reçoit le signal de coïncidence.
\vspace*{-0.4cm}
\subsection{Format de données}
\vspace*{-0.4cm}
Les événement sont envoyés par TCP/IP et enregistrés sous forme de blocs binaires. Les informations codées dans ces blocs sont données tableau \ref{donnees}. Chaque Mézzanine est identifiable par son adresse IP, le côté des strips dont elle s'occupe est identifiable par "Numéro Mezzanine" (\num{0} ou \num{1}). À chaque strips touché est enregistré le numéro de la voie du PETIROC2 correspond, le temps permettant de se repérer dans un événement (BCID) de résolution \SI{200}{\nano\second} et le temps enregistré par le TDC (Coarse et Fine).

\begin{table}[!ht]
	\centering
\begin{tabular}{|OOO|O|N}
	\hline
	\multicolumn{3}{|c|}{Contenu d'un événement}& Taille (octets) \\ 
	\hline
	\multicolumn{3}{|c|}{Nombre de Mezzanine $N_{mez}$}& 4 \\ 
	\hline
	\multirow{13}{1.5cm}{$N_{mez}\times $}&\multicolumn{2}{|c|}{Detector Id}& 4 \\ \cline{2-4}
	&\multicolumn{2}{|c|}{Datasource Id }& 4 \\ \cline{2-4}
	&\multicolumn{2}{|c|}{Event Id }& 4 \\ \cline{2-4}
	&\multicolumn{2}{|c|}{Bunch Crossing Id}& 8 \\ \cline{2-4}
	&\multicolumn{2}{|c|}{Numéro d'évènement}& 4 \\ \cline{2-4}
	&\multicolumn{2}{|c|}{Global Trigger Counter (GTC)}&4\\\cline{2-4}
	&\multicolumn{2}{|c|}{BCID Mezzanine}&8\\\cline{2-4}
	&\multicolumn{2}{|c|}{Numéro Mezzanine}&4\\\cline{2-4}
	&\multicolumn{2}{|c|}{IP Mézzanine}&4\\\cline{2-4}
	&\multicolumn{2}{|c|}{Nombre de voies touchés $N_{touch}$}&4\\\cline{2-4}
	&\multicolumn{1}{|c|}{\multirow{3}{1.5cm}{$N_{touch}\times $}}&Numéro de la voie&1\\\cline{3-4}
	&\multicolumn{1}{|c|}{}&BCID Strip&2\\\cline{3-4}
	&\multicolumn{1}{|c|}{}&Coarse&4\\\cline{3-4}
	&\multicolumn{1}{|c|}{}&Fine&1\\\cline{3-4}
	\hline
	\multicolumn{3}{|c|}{Total}&$4+N_{mez}\times(48+N_{touch}\times8)$\\
	\hline
\end{tabular}
\caption{Contenu d'un événement et taille en octets.}\label{donnees}
\end{table}

\newpage
Les événements sont créer grâce à un générateur de fonction qui envoi un créneaux déclenchant ainsi le début et la fin d'un événement. A la fin d'un événement, les données sont envoyés et un signal "busy" est activé afin de bloquer la prise d'événement pendant l'exportation des données vers l'ordinateur.

\subsection{Programme d'analyse}
Le programme d'analyse est écrit en \Cpp en utilisant ROOT. Il permet de lire les données binaire et de chercher les hits correspondant à la coïncidence des scintillateurs et de trouver leur temps TDC $T_0$. Afin de simplifier l'analyse, seul les événements comportant un seul hit de ce type sont selectionnés. Les événements comportant un nombre de hits trop important ($>1000$) sont également rejetés.

Pour chaque hits de l'événement, le temps d'arrivé $T$ de celui-ci par rapport au signal des scintillateurs est calculé :
\begin{equation}
	T^n=T'^n-T_0
\end{equation}
avec $T'$ la valeur du temps TDC du hit $n$. 

Un ajustement par une fonction Gaussienne de la distribution des $T^n$ est ensuite effectué. La distribution présentant de nombreux pics (cf.fig\ref{pics}), seul la zone proche du premier pics (proche du temps $T_0$) est prise en compte dans l'ajustement. La zone correspondant au signal est ensuite prise comme étant l'intervalle $\left[T_0-\num{1.5}\sigma,T_0-\num{1.5}\sigma\right]$.

\begin{figure}[!ht]
	\centering
	\scalebox{0.45}{\includetex{ELE/Pic}}
	\caption{Distribution des $T^n$ pour une chambre et ajustement par une fonction Gaussienne de la zone proche du premier pic.}
	\label{pics}
\end{figure}

Pour chaque strips, la distribution des $T^{n,s}_1-T^{n,s}_2$ où $T^{n,s}_1=T_{'n,s}^{1}-T_0$ ($T^{n,s}_2$) est le temp du hits $n$ du strips $s$ par rapport au temps du signal des scintillateur $T^{0}$ lus d'un côté (de l'autre).

La figure \ref{t2t0} représente la distribution des $T^{n,21}_2$ de la chambre en Bakélite \SI{1.4}{\milli\meter}.
\begin{figure}[ht!]
	\centering
	\includegraphics[width=0.40\textwidth]{ELE/TimingFitsRunT1T0_zoom_736185.jpg}
	\captionof{figure}{Distribution des $T^{n,21}_2$ de la chambre en Bakélite \SI{1.4}{\milli\meter}.}
	\label{t2t0}
\end{figure}

Le programme effectue le calcul de l'efficacité des chambres ainsi  qu'une clusterisation d'un côté et de l'autre afin d'obtenir le cluster size et la probabilité de streamer. 

\subsection{Résultats}

Avant de nous intéresser à la précision spatiale et temporelle obtenue par ces chambres nous avons effectuer des scans en tension afin d'obtenir les courbes d'efficacités et de courants pour ces chambres. Ces chambres étant nouvelles et n'ayant jamais été testées avant, nous voulions nous assurer de leur bon fonctionnement.

La différence de courants parcourants les chambres entre les périodes sans faisceaux et avec faisceaux en fonction de la haute tension appliquée est donnée par la figure \ref{courant1.4} (\ref{courant1.6}) pour la chambre \SI{1.4}{\milli\meter} (\SI{1.6}{\milli\meter}).

\begin{figure}[ht!]
	\vspace{-0.5cm}
	\centering
	\subfloat[chambre \SI{1.4}{\milli\meter}.]{\scalebox{0.68}{\includetex{ELE/1p4}}\label{courant1.4}}
	\subfloat[chambre \SI{1.6}{\milli\meter}.]{\scalebox{0.68}{\includetex{ELE/1.6}}\label{courant1.6}}
	\caption{différence de courants parcourants les chambres entre les périodes sans faisceaux et avec faisceaux en fonction de la haute tension appliquée.}
	\label{courant1.41.6}
\end{figure}


Cependant, le PCB s'est révélé trop épais (\SI{700}{\micro\meter}) de chaque côté des strips, ce qui fait baisser artificiellement l'efficacité.

\begin{figure}[!ht]
	\centering
	\scalebox{0.7}{\includetex{ELE/Fit}}
	\caption{Résolution temporelle d'un strips du PCB. Le signal est est carré d'amplitude \SI{10}{\volt} et de durée \SI{10}{\nano\second}. Le signal traverse un condensateur de \SI{1}{\pico\farad}.}
	\label{Fit}
\end{figure}