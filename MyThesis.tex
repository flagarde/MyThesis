\documentclass[12pt,a4paper,twoside,french,openright]{book}
\makeatletter
\let\latex@include\include
\def\include#1{\include@aux#1\@nil}
\def\include@aux#1/#2\@nil{\@mkdir{#1}\latex@include{#1/#2}}
\ifnum\pdfshellescape=\@ne
\def\@mkdir#1{\immediate\write18{mkdir -p ./build/#1}}
\else
\def\@mkdir{\typeout{Expect errors}}
\fi
\makeatother 
\hyphenpenalty=3500
\doublehyphendemerits=9000
\finalhyphendemerits=6000
\RequirePackage[l2tabu, orthodox]{nag}
\usepackage{textcomp}
\usepackage{afterpage,everypage}
\usepackage{pdflscape}
\usepackage{rotating}
\usepackage{float}
\usepackage{amsmath}
\usepackage{physics}
\usepackage{cmap}
\usepackage[T1]{fontenc}
\usepackage[french]{babel}
\usepackage{enumitem}
\usepackage[utf8]{inputenc}
\DeclareTextSymbolDefault{\cyre}{T2A}
\DeclareTextSymbolDefault{\CYRE}{T2A}
\DeclareTextSymbolDefault{\cyrf}{T2A}
\usepackage[hypcap=true]{caption}
\usepackage{collcell}
\usepackage{booktabs}
\usepackage{xcolor,colortbl}
\usepackage[backend=biber,style=numeric,sorting=none,hyperref=true]{biblatex}
\usepackage[toc,acronym,nomain,nonumberlist]{glossaries}
\usepackage[acronym,automake,nomain]{glossaries-extra}
\usepackage{csquotes}
\usepackage{cellspace}
\cellspacetoplimit=4pt
\cellspacebottomlimit=4pt
\usepackage{minipage-marginpar}
\usepackage{calc}
\usepackage{lmodern}
\usepackage{microtype}
\usepackage[top=2.05cm,bottom=1.1cm,left=1cm,right=5cm,marginparsep=0.50cm,marginparwidth=4.25cm,headheight=25pt]{geometry}
\usepackage{booktabs}
\usepackage{layout}
\usepackage{graphicx}
\usepackage{makecell}
\usepackage{titlesec}
\usepackage{setspace}
\usepackage{pgf}
\usepackage{soulutf8}
\usepackage[outline]{contour}
\usepackage{eqnarray}
\usepackage{tikz}
\usepackage{lscape}
\usepackage{url}
\usepackage[subfigure]{tocloft}
\setlength{\cftfignumwidth}{3em}
\usepackage{fancyhdr}
\usepackage{blindtext}
\usepackage{wrapfig}
\usepackage{cutwin}
\usepackage{framed}
\usepackage{colortbl}
\usepackage{tabularx}
\usepackage{amssymb,mathrsfs}
\usepackage{makeidx}
\usepackage{lettrine}
\usepackage{coffee4}
\usepackage{fancybox}
\usepackage[lofdepth,lotdepth]{subfig}
\usepackage{multirow}
\usepackage{multicol}
\usepackage{graphicx}
\usepackage{eso-pic}
\usepackage{lipsum}
\usepackage[Bjornstrup]{fncychap}
\usepackage{hyperref}
%%% --- The following two lines are what needs to be added --- %%%
\setcounter{biburllcpenalty}{7000}
\setcounter{biburlucpenalty}{8000}
%\usepackage[all]{hypcap}
\usepackage[french,tight]{minitoc}
\hypersetup{colorlinks=true,breaklinks=true,bookmarksopen=true,urlcolor=gray,citecolor=gray,linkcolor=gray}                                                    
\setlength{\fboxsep}{0mm}
\renewcommand {\mtctitle} {}
\usepackage{ifthen}
\usepackage{marginnote}
\usepackage{chngpage}
\usepackage{pdfcomment}
\usepackage{feynmp}
\usepackage{marginfit}
\usepackage[mode=build]{standalone}
\usepackage{pgfplots}
\usepackage{wallpaper}
\pgfplotsset{width=10cm,compat=newest}
\usepackage{silence}
\WarningFilter{Fancyhdr}{\headheight is too small}
\usepackage[tight]{shorttoc}
\usepackage{chemist}
\usepackage{listing}
\usepackage{morewrites}
\pgfplotsset{compat=newest}
\usepgfplotslibrary{external,colormaps} 
%\tikzexternalize
\tikzset{%
	external/force remake=false,
	/tikz/external/optimize=false,
	external/system call={pdflatex \tikzexternalcheckshellescape --halt-on-error --interaction=batchmode --output-directory=./build --jobname "\image" "\texsource"},
	/pgf/images/include external/.code={%
		\includegraphics{build/#1}%
	},
}

% Define the command. Note that the input and output folders are static!
\newcommand{\includetex}[1]
{%
	\tikzsetnextfilename{#1}%
	\input{#1.tex}%
}
\newcommand*\rot{\rotatebox{90}}
\usepackage{ifthen}
\newcommand{\Cpp}[1][]{$\text{C\hspace{-.25ex}}^{_{_{_{++}}}}\ifthenelse{\equal{#1}{}}{}{\text{\hspace{-.625ex}#1}}$}
\newcommand*\diff{\mathop{}\!\mathrm{d}}
\newcommand*\Diff[1]{\mathop{}\!\mathrm{d^#1}}
\usepackage{tocbibind}
%\DeclareMathSymbol{\Omega}{\mathalpha}{letters}{"0A}% italics
\DeclareMathSymbol{\varOmega}{\mathalpha}{operators}{"0A}% upright
\providecommand*{\upOmega}{\varOmega}% for siunitx
\usepackage[binary-units=true]{siunitx}
\sisetup{locale = FR}
\DeclareSIUnit{\bits}{bits}
\DeclareSIUnit{\hit}{Hits}
\DeclareSIUnit{\hitt}{Hit}
\DeclareSIUnit{\strip}{Strip}
\DeclareSIUnit\sq{\ensuremath{\Box}}
\DeclareSIUnit\clusters{cluster}
\DeclareSIUnit{\c}{c}
\DeclareSIUnit{\atm}{atm}

\DeclareFontShape{OT1}{cmr}{bx}{sc}{<-> cmbcsc10}{}
%"Bugfix" for fncychap:
%Without this code there will be an overfull hbox by 10pt on every chapter
%I don't remember where I found this, but it seems to be unrelated to 
%the problem sice the header looks the same when commented out.     
%--------------------------------------------------------------------------
\renewcommand{\DOCH}{%
	\settowidth{\py}{\CNoV\thechapter}
	%\addtolength{\py}{-2pt}      % Amount of space by which the
	%                                % number is shifted right
	\fboxsep=0pt%
	\colorbox[gray]{.85}{\rule{0pt}{40pt}\parbox[b]{\textwidth}{\hfill}}%
	\kern-\py\raise20pt%
	\hbox{\color[gray]{.5}\CNoV\thechapter}\\%
}

\makeatletter
\newcommand{\listequation}[2]{$\displaystyle #1$\hfill\refstepcounter{equation}\label{#2}\textup{\tagform@{\theequation}}}
\makeatother

\SetProtrusion{encoding={*},family={*},series={*},size={6,7,8}}{1={ ,750},2={ ,500},3={ ,500},4={ ,500},5={ ,500},6={ ,500},7={ ,600},8={ ,500},9={ ,500},0={ ,500}}
\microtypecontext{kerning=french}
\usetikzlibrary{calc,positioning,shadows.blur,decorations.pathreplacing,shapes,positioning,patterns,plotmarks}
\usepackage{etoolbox}
\newcolumntype{Y}[1]{>{\centering\arraybackslash}p{#1}<{\centering\arraybackslash}}
\newcolumntype{L}{>{\arraybackslash\vspace{0.1cm}}Cc<{\vspace{0.1cm}\arraybackslash}}
\newcolumntype{O}{>{\centering\arraybackslash}Cc<{\centering\arraybackslash}}
\newcolumntype{N}{@{}m{0pt}@{}}
%%%%%Use titlesec to color section subsection subsubsection
\newcommand{\ColorSection}[1]{\colorbox{black!65}{\parbox[c][1.5em][c]{\dimexpr\textwidth-2\fboxsep}{\hspace{0.2cm}\textcolor{white}{\thesection\ #1}\hspace*{0.5cm}}}}
\titleformat{\section}{\rmfamily\large\raggedright}{}{0pt}{\ColorSection}     
\titleformat{name=\section,numberless}{\rmfamily\large\raggedright}{}{0pt}{\ColorSection}       
\newcommand{\ColorSubSection}[1]{\colorbox{black!65}{\parbox[c][1.5em][c]{\dimexpr\textwidth-2\fboxsep}{\hspace{0.2cm}\textcolor{white}{\thesubsection\ #1}\hspace*{0.5cm}}}}
\titleformat{\subsection}{\rmfamily\raggedright}{}{0pt}{\ColorSubSection}     
\titleformat{name=\subsection,numberless}{\rmfamily\raggedright}{}{0pt}{\ColorSubSection}       
\newcommand{\ColorSubSubSection}[1]{\colorbox{black!55}{\parbox[c][1.5em][c]{\dimexpr\textwidth-2\fboxsep}{\hspace{0.2cm}\textcolor{white}{\thesubsubsection\ #1}\hspace*{0.5cm}}}}
\titleformat{\subsubsection}{\rmfamily\raggedright}{}{0pt}{\ColorSubSubSection}
\titleformat{name=\subsubsection,numberless}{\rmfamily\raggedright}{}{0pt}{\ColorSubSubSection}   
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\titlespacing*{\section}{0pt}{\baselineskip}{\baselineskip}
\titlespacing*{\subsection}{0pt}{\baselineskip}{\baselineskip}
\titlespacing*{\subsubsection}{0pt}{\baselineskip}{\baselineskip}
\newlength{\mylength}
\setlength{\mylength}{\textheight+\headsep-\paperheight}

\makeatletter
\newlength\myrightmargin
\setlength\myrightmargin{\Gm@rmargin}
\newlength\mymarge
\setlength\mymarge{0.45\textwidth}
\makeatother 

\newcommand{\void}{\vspace*{\paperheight}\textcolor{gray!30}{\hrule}}
\newcommand{\leftnum}{\vspace*{\paperheight}\textcolor{white}{\hrule}\vspace{0.2cm}\makebox[\textwidth][l]{\hspace{0.5cm}\sffamily\textcolor{white}{ \Large{\thepage}}}\vspace{0.5cm}}
\newcommand{\rightnum}{\vspace*{\paperheight}\textcolor{white}{\hrule}\vspace{0.2cm}\makebox[\textwidth][r]{\sffamily\textcolor{white}{ \Large{\thepage}}\hspace{0.5cm}}\vspace{0.5cm}}

\newcommand{\MargeSimple}[2]
{%
	\ClearShipoutPicture
	\AddToShipoutPicture{%
		\ifthenelse{\isodd{\value{page}}}{
			\AtPageLowerRight{%
				{\colorbox{gray!30}{%
						\begin{minipage}[b]{\dimexpr\myrightmargin-0.5\marginparsep\relax}
							\vspace*{\paperheight}
							#2
						\end{minipage}%
				}}%
			}%
		}
		{
			\AtPageLowerLeft{%
				{\colorbox{gray!30}{%
						\begin{minipage}[b]{\dimexpr\myrightmargin-0.5\marginparsep\relax}
							\vspace*{\paperheight}
							#1
						\end{minipage}%
				}}%
			}%
		}
	}
    %\ClearShipoutPicture
}
\newcommand{\rien}
{%
	\ClearShipoutPicture
	\AddToShipoutPicture{}
}
\usepackage[nokeyprefix]{refstyle}
\mtcsetdepth{minitoc}{2}
\mtcsettitle{minitoc}{Contenu :}
\usepackage{listings}
\usepackage{cleveref} %GEEENIAAAAL!!!
%\let\oldfootnotesize\footnotesize
%\renewcommand*{\footnotesize}{\oldfootnotesize\fontsize{5}{7}}

\captionsetup{justification=raggedright,labelfont={color=gray,bf,small},font=small}

\newcommand{\ligne}{\color{gray}{\rule{\linewidth}{5pt}}\vspace{0.2cm}\color{black}}

\makeatletter
\newcommand\At@Page@Upper@Right[1]{%
  \put(\LenToUnit{\paperwidth},\LenToUnit{\paperheight}){#1}%
}
\newcommand\AtPageLowerRight[1]{\At@Page@Upper@Right{%
  \put(0,\LenToUnit{-\paperheight}){\llap{#1}}}}
\makeatother

\renewcommand{\contentsname}{Table des matières}
\renewcommand{\thechapter}{\arabic{chapter}}
\renewcommand{\thesection}{\arabic{section}}
\renewcommand{\thesubsection}{\thesection.\arabic{subsection}}
\renewcommand{\thesubsubsection}{}

%% Command to hold chapter illustration image
\newcommand\chapterillustration{}
\titlespacing*{\chapter}{0pt}{0pt}{135mm}

\newcommand{\repeatcaption}[2]{%
  \addtocounter{figure}{-1}%
  \renewcommand{\thefigure}{\ref{#1}}%
  \captionsetup{list=no, labelformat=simple, labelsep=colon}%
  \captionof{figure}{#2}%
}

\newcommand{\repeatsubcaption}[2]{%
  \renewcommand{\thesubfigure}{\subref{#1}}%
  \captionsetup{list=no, labelformat=parens, labelsep=space}%
  \captionof{subfigure}{#2}%
}

%%%%********************************************************************
% fancy quotes
\definecolor{quotemark}{gray}{0.7}
\makeatletter
\def\fquote{%
    \@ifnextchar[{\fquote@i}{\fquote@i[]}%]
}%
\def\fquote@i[#1]{%
    \def\tempa{#1}%
    \@ifnextchar[{\fquote@ii}{\fquote@ii[]}%]
}%
\def\fquote@ii[#1]{%
    \def\tempb{#1}%
    \@ifnextchar[{\fquote@iii}{\fquote@iii[]}%]
}%
\def\fquote@iii[#1]{%
    \def\tempc{#1}%
    \@ifnextchar[{\fquote@iiii}{\fquote@iiii[]}%]
}%
\def\fquote@iiii[#1]{%
    \def\tempd{#1}%
    \vspace{1em}%
    \noindent%
    \begin{list}{}
    {%
    		\setlength{\leftmargin}{0.1\textwidth}%
      \setlength{\rightmargin}{0.1\textwidth}%
    }%
    \item[]%
    \begin{picture}(0,0)%
    \put(\tempd,-15){\makebox(0,0){\scalebox{3}{\textcolor{quotemark}{``}}}}%
    \end{picture}%
    \begingroup\itshape
 }%
 %%%%********************************************************************
 \def\endfquote
 {%
    %\vspace*{0.15cm}
 	\endgroup\par%
 	\makebox[0pt][l]{%
 	\hspace{0.8\textwidth}%
 	\vspace{0.1cm}%
 	\begin{picture}(0,0)(0,0)%
 	\put(15,8){\makebox(0,0){\scalebox{3}{\color{quotemark}''}}}%
 	\end{picture}}%
 	\ifx\tempa\empty%
 	\else%
  \ifx\tempb\empty%
  \hfill\mbox{}\hfill\tempa%
  \else%
  \ifx\tempc\empty%
  \hfill\mbox{}\hfill\tempa,\ \emph{\tempb}%
  \else%
  \hfill\mbox{}\hfill\tempa,\ \emph{\tempb},\ \tempc%
  \fi\fi\fi\par%
  \vspace{0.7em}%
 	\end{list}%
 }%
 \makeatother
 %%%%********************************************************************
%\mtcsetfeature{minitoc}{open}{\vspace{-1.5cm}}
\setcounter{tocdepth}{3}
\makeindex

\renewcommand{\LettrineFontHook}{\color{gray}}
\usepackage{yfonts}

\newcommand{\lettrines}[2]{\lettrine[lines=2, slope= -0.5em, lhang=0.25, loversize=0.25]{#1}{\small #2}}

\makeatletter
\renewcommand{\fnum@figure}{Fig. \thefigure}
\makeatother

\interfootnotelinepenalty=10000
\setlength{\parskip}{\baselineskip}
\addbibresource{bibli.bib}

\renewcommand{\headrulewidth}{0pt}
\renewcommand{\footrulewidth}{0pt}
\fancypagestyle{plain}{\fancyhf{}\fancyhead{}\renewcommand{\headrulewidth}{0pt}} 
\fancypagestyle{void}{\fancyhf{}\fancyhead{}\renewcommand{\headrulewidth}{0pt}} 

\definecolor{shadecolor}{gray}{0.75}

\newcommand{\balajipage}[1]{\fboxsep=0pt\colorbox{shadecolor}{\balajistrut\makebox[#1][c]{}}}
\newcommand{\balajihead}[1]{\fboxsep=0pt\colorbox{shadecolor}{\balajistrut\makebox[\textwidth][s]{#1}}}

\newcommand{\balajistrut}{%
	\vrule width 0pt 
	height 1.5\ht\strutbox 
	depth 1.5\dp\strutbox
}
\newlength{\mylengthh}
\fancypagestyle{mystyle}
{
	\fancyhf{} 
	\fancyhead[RE,RO]{}
	\fancyheadoffset[LE,RO]{\marginparsep+\marginparwidth}
	\setlength{\mylengthh}{\widthof{\fontsize{55}{10}\selectfont \hbox{\color[gray]{.5}\CNoV\thechapter}}}
	\fancyhead[LO]
	{%
		\begin{minipage}{\textwidth}
			\balajihead{\quad\bfseries\color{white}\textbf{\leftmark}\hfill}%
			\hspace*{-1\mylengthh}
			\noindent
			\begin{minipage}{\widthof{\fontsize{55}{10}\selectfont \hbox{\color[gray]{.5}\CNoV\thechapter}}}
				\vspace*{-0.30cm}
				\fontsize{55}{10}\selectfont \hbox{\color[gray]{.5}\CNoV\thechapter}
			\end{minipage}%
			\hspace*{-0.16\mylengthh}
			\makebox[\myrightmargin][r]{\balajipage{\dimexpr\myrightmargin-0.5\marginparsep\relax}}%
		\end{minipage}
	}
	\fancyhead[LE]
	{%
		\begin{minipage}{\textwidth}
			\hspace*{-0.78\marginparsep}
			\makebox[\myrightmargin][l]{\balajipage{\dimexpr\myrightmargin-0.5\marginparsep\relax}}%
			\balajihead{\hfill\bfseries\color{white}\textbf{\leftmark}\quad}%
			\hspace*{-\textwidth}
			\noindent
			\begin{minipage}{\widthof{\fontsize{55}{10}\selectfont \hbox{\color[gray]{.5}\CNoV\thechapter}}}
				\vspace*{-0.30cm}
				\fontsize{55}{10}\selectfont \hbox{\color[gray]{.5}\CNoV\thechapter}
			\end{minipage}%
		\end{minipage}
	}
	\fancyfoot[RO]{}
	\fancyfoot[LE]{}
}

\makeatletter
\newif\if@nothing
\@nothingtrue
\newif\if@backmatter
\@backmatterfalse
\newif\if@frontmatter
\@frontmatterfalse
\newif\if@supress
\@supressfalse
\renewcommand\frontmatter{\cleardoublepage\@nothingfalse\@mainmatterfalse\@frontmattertrue\@backmatterfalse\pagenumbering{roman}}
\renewcommand\mainmatter{\cleardoublepage\@nothingfalse\@mainmattertrue\@frontmatterfalse\@backmatterfalse\pagenumbering{arabic}}
\renewcommand\backmatter{\if@openright\cleardoublepage\else\clearpage\fi\@nothingfalse\@mainmatterfalse\@frontmatterfalse\@backmattertrue}
\newcommand{\nothing}{\cleardoublepage\@nothingtrue\@mainmatterfalse\@frontmatterfalse\@backmatterfalse\pagenumbering{roman}}
\newcommand{\reset}{\cleardoublepage\@nothingfalse\@mainmatterfalse\@frontmatterfalse\@backmatterfalse\pagenumbering{roman}}
\AddEverypageHook{%
	\if@nothing
		\pagestyle{void}
		\rien{}
	\else
		\if@supress
		    \MargeSimple{\void}{\void}
		    \pagestyle{void}
		\else
			\if@mainmatter
				\MargeSimple{\leftnum}{\rightnum}
			\else
				\if@frontmatter
					\MargeSimple{\leftnum}{\rightnum}
				\else
					\if@backmatter
						\MargeSimple{\void}{\void}
					\else
				     	\pagestyle{void}
			    	 	\rien{}
					\fi
				\fi
			\fi
		\fi
	\fi
}
\makeatother
%\hyphenation{phénol-formaldéhyde}
\makeatletter
\def\cleardoublepage{\@supresstrue\clearpage\if@twoside \ifodd\c@page\else\hbox{}\newpage\if@twocolumn\hbox{}\newpage\fi\fi\fi\@supressfalse}
\makeatother
\makeglossaries
\include{GLO/GLO}
\patchcmd{\chapter}{plain}{empty}{}{}
\patchcmd{\part}{plain}{empty}{}{}
\begin{document}
\pagestyle{void}
\nothing{}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Page de garde %%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\setcounter{page}{-1}
\begin{titlepage}	
	\setcounter{page}{-1}
	\include{PG/PG}
\end{titlepage}
\setcounter{page}{-1}
\shipout\null
\shipout\null
\begin{titlepage}	
	\include{PG/PG}
\end{titlepage}
\begin{titlepage}	
	\setcounter{page}{3}
	\include{PG2/PG2}
\end{titlepage}
\microtypesetup{protrusion=false}
\dominitoc
\microtypesetup{protrusion=true}
\begin{titlepage}
\setcounter{page}{5}
\newgeometry{left=0cm,bottom=1.5cm,right=0cm,top=1.5cm,headheight=45pt}
\vspace*{5cm}
\begin{fquote}[(Ecc. I, 18)][][][275]
\begin{flushright}
Qui addit scientiam addit et dolorem
\end{flushright}
\end{fquote}
\end{titlepage}
\setcounter{page}{6}
\frontmatter
\setcounter{page}{7}
\begingroup
\makeatletter
\patchcmd{\l@section}{%
	\addvspace{1.0em \@plus\p@}% original code line
}{
	\addvspace{20pt \@plus 0.2\p@}% substitute code line
}{}{}
\makeatother
\shorttoc{Sommaire}{1}
\endgroup
\mainmatter
\pagestyle{mystyle}
\renewcommand{\chaptermark}[1]{\markboth{#1}{}}
\renewcommand{\sectionmark}[1]{\markright{#1}{}}
{\fontsize{11}{11} \selectfont
\pagestyle{void}
\include{REM/REM}
\include{INT/INT}
\pagestyle{mystyle}
\include{SM/SM}
\include{LHC/LHC}
\include{CMS/CMS} 
\include{RPC/RPC}
\include{GLA/GLA}
\include{ELE/ELE}
\include{CON/CON}
\appendix
\include{TAB/TAB}
\include{ELOG/ELOG}
}
\backmatter
\fancyhf{} 
\printbibliography
\newpage\null\thispagestyle{empty}\newpage
\microtypesetup{protrusion=false}
\listoffigures
\microtypesetup{protrusion=true}
\newpage\null\thispagestyle{empty}\newpage
\microtypesetup{protrusion=false}
\listoftables
\microtypesetup{protrusion=true}
\newpage\null\thispagestyle{empty}\newpage
\microtypesetup{protrusion=false}
\pagestyle{void}
\tableofcontents
\printindex
\glsaddall
\printglossary[type=\acronymtype,title={Acronymes}]
\microtypesetup{protrusion=true}
\end{document}